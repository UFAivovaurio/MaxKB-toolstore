# MCP Output提取工具

## 一、项目介绍

### 1.1 核心功能
本工具用于从包含MCP（Model Call Protocol）工具调用日志的文本中，自动提取各工具调用返回的JSON格式输出数据。支持两种输入结构：
- 嵌套在 `<details>` 标签中的结构化日志（推荐）：自动识别 `<em>工具名</em>` 作为键，提取对应的 `Output:` JSON 内容；
- 非结构化文本：直接匹配 `Output:` 后的 JSON 块，使用 `output_1`, `output_2` 等作为默认键名。

工具内置智能JSON解析器，可自动修复常见格式错误（如尾部逗号、单引号、控制字符），提升解析成功率。

### 1.2 适用场景
- **自动化测试验证**：在MCP调用测试中，自动校验各工具返回的JSON结构是否符合预期。
- **日志分析与调试**：从系统日志或AI代理输出中快速提取工具响应数据，用于问题定位。
- **API集成开发**：将非结构化AI响应转换为结构化字典，便于下游程序处理。
- **数据流水线构建**：从大语言模型输出中提取结构化结果，作为后续处理的输入源。

## 二、环境准备

### 2.1 依赖库

| 依赖库 | 版本要求 | 用途说明 |
|--------|----------|----------|
| `json` | Python内置 | 解析和序列化JSON数据 |
| `re` | Python内置 | 正则表达式匹配，用于提取文本块和JSON内容 |
| `typing` | Python内置 | 类型注解支持，提升代码可读性与IDE提示 |

> 注：本工具仅依赖Python标准库，无需额外安装第三方包。

### 2.2 安装依赖
无需安装，直接使用Python 3.7+环境即可运行。

## 三、参数说明

### 必需参数

| 参数名 | 类型 | 说明                                                                      | 示例 |
|--------|------|-------------------------------------------------------------------------|------|
| `text_content` | `str` | 包含MCP工具调用日志的完整文本内容，需包含`<details>`块或`Output:`标记 或者 直接输入 AI节点（包含MCP）的结果即可 | `"<details>...<em>account_search</em>...Output: ```json\n{\"list\": []}\n```</details>"` |

### 可选参数
本工具无显式可选参数，所有行为由内部逻辑控制。

## 四、注意事项

1. **JSON格式容错有限**：虽然工具尝试修复尾部逗号、单引号等常见错误，但对严重语法错误（如嵌套不闭合、非法字符）仍可能失败，建议上游输出标准化JSON。
2. **工具名提取依赖HTML标签**：工具名称必须位于 `<em>...</em>` 标签内，且前缀为 `Called MCP Tool:`，否则将无法识别，回退至`output_n`索引模式。
3. **多块输出顺序不保证**：若使用非`<details>`模式提取，`output_n`的顺序取决于正则匹配顺序，非插入顺序，建议尽量使用结构化`<details>`格式。
4. **大文本性能考虑**：`re.findall(..., re.DOTALL)` 在超大文本中可能消耗较多内存，建议对超长日志做分块处理。

## 五、支持
如遇解析失败、格式不兼容或功能需求，请提交Issue至项目仓库或联系开发团队提供样本日志，以便优化正则匹配与JSON修复逻辑。